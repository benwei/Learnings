
CFILES := $(wildcard *.c)
TARGETS := $(CFILES:.c=)
OBJS := $(patsubst %.c,%.o,$(CFILES))

all: $(TARGETS)

% : %.o
	$(CC) $< $(LDFLAGS) -o $@

run: $(TARGETS)
	@for target in $(TARGETS) ; do \
		argname="RUN_ARGS_$$target" ; \
		make test-single TARGET=$$target TARGET_ARGS="$${argname}" ; \
	done

test-single: 
	@echo == exec ./$(TARGET) $($(TARGET_ARGS)) ; \
	./$(TARGET) $($(TARGET_ARGS)) ; 

clean:
	rm -f $(TARGETS) *.o

